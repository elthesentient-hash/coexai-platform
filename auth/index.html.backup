<!DOCTYPE html>
<html lang="en" x-data="realAuth()">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get Started - CoExAI (Demo Mode)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <script src="/demo/mock-api.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Inter', system-ui, sans-serif; -webkit-font-smoothing: antialiased; }
        body { background: #050505; color: #fafafa; }
        .gradient-text {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 25%, #f093fb 50%, #f5576c 75%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .gradient-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
        .step-active { border-color: #667eea; color: #667eea; }
        .step-completed { border-color: #10b981; color: #10b981; }
        .plan-card { transition: all 0.3s ease; cursor: pointer; }
        .plan-card:hover { transform: translateY(-4px); }
        .plan-selected { border-color: #667eea; box-shadow: 0 0 0 2px #667eea; }
        .error-message { color: #ef4444; font-size: 0.875rem; margin-top: 0.5rem; }
        .demo-banner { 
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }
        [x-cloak] { display: none !important; }
    </style>
</head>
<body class="min-h-screen">

    <!-- Demo Banner -->
    <div class="demo-banner text-center py-2 text-sm font-medium">
        üéÆ DEMO MODE - Try everything without real signup!
        <span class="opacity-75">(This is a simulation - no real accounts created)</span>
    </div>

    <script>
        // DEMO MODE: Use mock API instead of real backend
        window.API_URL = '/demo';
        
        // Helper to use mock API
        async function apiCall(endpoint, options = {}) {
            // Parse endpoint and call appropriate mock function
            if (endpoint === '/api/auth/register') {
                const body = JSON.parse(options.body);
                return mockAPI.register(body.email, body.password, body.name, body.plan);
            }
            if (endpoint === '/api/auth/login') {
                const body = JSON.parse(options.body);
                return mockAPI.login(body.email, body.password);
            }
            if (endpoint === '/api/auth/me') {
                return mockAPI.getMe();
            }
            if (endpoint.startsWith('/api/connect/')) {
                const platform = endpoint.split('/').pop();
                return mockAPI.connectPlatform(platform);
            }
            if (endpoint === '/api/platforms') {
                return mockAPI.getPlatforms();
            }
            if (endpoint === '/api/payments/create-checkout') {
                return mockAPI.createCheckout();
            }
            
            throw new Error('Unknown endpoint: ' + endpoint);
        }
        
        // Check if already in demo mode
        console.log('üéÆ DEMO MODE ACTIVE - All functions simulated');
    </script>

    <!-- Navigation -->
    <nav class="border-b border-white/5">
        <div class="max-w-6xl mx-auto px-4 py-4">
            <a href="/" class="flex items-center gap-2">
                <div class="w-8 h-8 rounded-lg gradient-purple flex items-center justify-center">
                    <i data-lucide="sparkles" class="w-5 h-5 text-white"></i>
                </div>
                <span class="font-bold text-xl">CoExAI</span>
            </a>
        </div>
    </nav>

    <!-- Error Banner -->
    <div x-show="error" x-cloak class="bg-red-500/10 border border-red-500/20 text-red-400 px-4 py-3 text-center">
        <span x-text="error"></span>
        <button @click="error = null" class="ml-2 text-red-300 hover:text-red-200">√ó</button>
    </div>

    <!-- Progress Steps -->
    <div class="max-w-4xl mx-auto px-4 py-8">
        <div class="flex items-center justify-center gap-4 mb-8">
            <template x-for="(step, index) in steps" :key="index">
                <div class="flex items-center"
                >
                    <div class="flex items-center gap-2"
                        :class="{
                            'step-active': currentStep === index,
                            'step-completed': currentStep > index,
                            'text-gray-500': currentStep < index
                        }"
                    >
                        <div class="w-8 h-8 rounded-full border-2 flex items-center justify-center text-sm font-semibold"
                            :class="{
                                'border-purple-500 text-purple-400': currentStep === index,
                                'border-green-500 text-green-400': currentStep > index,
                                'border-gray-600 text-gray-500': currentStep < index
                            }"
                        >
                            <template x-if="currentStep > index">
                                <i data-lucide="check" class="w-4 h-4"></i>
                            </template>
                            <template x-if="currentStep <= index">
                                <span x-text="index + 1"></span>
                            </template>
                        </div>
                        
                        <span class="text-sm hidden sm:block" x-text="step"></span>
                    </div>
                    
                    <template x-if="index < steps.length - 1">
                        <div class="w-12 h-px bg-gray-700 mx-2"
                            :class="{ 'bg-purple-500': currentStep > index }"
                        ></div>
                    </template>
                </div>
            </template>
        </div>

        <!-- Step 1: Choose Plan -->
        <div x-show="currentStep === 0" x-cloak>
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold mb-2">Choose Your Plan</h1>
                <p class="text-gray-400">Start with a 14-day free trial. Cancel anytime.</p>
            </div>

            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
                <template x-for="plan in plans" :key="plan.id">
                    <div 
                        class="plan-card p-6 rounded-2xl bg-white/5 border border-white/10"
                        :class="{ 'plan-selected': selectedPlan === plan.id }"
                        @click="selectedPlan = plan.id"
                    >
                        <div class="flex justify-between items-start mb-4">
                            <div>
                                <h3 class="font-bold text-lg" x-text="plan.name"></h3>
                                <p class="text-sm text-gray-400" x-text="plan.followers"></p>
                            </div>
                            
                            <template x-if="plan.popular">
                                <span class="px-2 py-1 rounded-full gradient-purple text-xs font-semibold">Popular</span>
                            </template>
                        </div>

                        <div class="mb-4">
                            <span class="text-3xl font-bold" x-text="'$' + plan.price"></span>
                            <span class="text-gray-500">/mo</span>
                        </div>

                        <ul class="space-y-2 text-sm mb-6">
                            <template x-for="feature in plan.features">
                                <li class="flex items-center gap-2"
                                >
                                    <i data-lucide="check" class="w-4 h-4 text-green-400"></i>
                                    <span x-text="feature"></span>
                                </li>
                            </template>
                        </ul>

                        <div class="text-xs text-gray-500">
                            Includes <span x-text="plan.agents.length"></span> AI agents
                        </div>
                    </div>
                </template>
            </div>

            <div class="mt-8 flex justify-center">
                <button 
                    @click="currentStep = 1"
                    class="gradient-purple px-8 py-3 rounded-full font-semibold hover:opacity-90 transition-opacity"
                    :disabled="!selectedPlan"
                    :class="{ 'opacity-50 cursor-not-allowed': !selectedPlan }"
                >
                    Continue ‚Üí
                </button>
            </div>
        </div>

        <!-- Step 2: Create Account -->
        <div x-show="currentStep === 1" x-cloak>
            <div class="max-w-md mx-auto">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold mb-2">Create Your Account</h1>
                    <p class="text-gray-400">Start your 14-day free trial - no credit card required</p>
                </div>

                <form @submit.prevent="createAccount" class="space-y-4">
                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Full Name *</label>
                        <input 
                            type="text" 
                            x-model="form.name"
                            class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none transition-colors"
                            placeholder="John Doe"
                            required
                        >
                    </div>

                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Email *</label>
                        <input 
                            type="email" 
                            x-model="form.email"
                            class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none transition-colors"
                            placeholder="john@example.com"
                            required
                        >
                        <p class="error-message" x-show="errors.email" x-text="errors.email"></p>
                    </div>

                    <div>
                        <label class="block text-sm text-gray-400 mb-1">Password *</label>
                        <input 
                            type="password" 
                            x-model="form.password"
                            class="w-full px-4 py-3 rounded-xl bg-white/5 border border-white/10 focus:border-purple-500 focus:outline-none transition-colors"
                            placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"
                            required
                            minlength="8"
                        >
                        <p class="text-xs text-gray-500 mt-1">Must be at least 8 characters</p>
                        <p class="error-message" x-show="errors.password" x-text="errors.password"></p>
                    </div>

                    <div class="flex items-center gap-2">
                        <input 
                            type="checkbox" 
                            x-model="form.agreed"
                            id="terms"
                            class="rounded bg-white/5 border-white/10 w-4 h-4"
                            required
                        >
                        <label for="terms" class="text-sm text-gray-400">
                            I agree to the <a href="#" class="text-purple-400 hover:underline">Terms</a> and <a href="#" class="text-purple-400 hover:underline">Privacy Policy</a> *
                        </label>
                    </div>

                    <button 
                        type="submit"
                        class="w-full gradient-purple py-3 rounded-xl font-semibold hover:opacity-90 transition-opacity flex items-center justify-center gap-2"
                        :disabled="loading || !form.agreed"
                        :class="{ 'opacity-50 cursor-not-allowed': loading || !form.agreed }"
                    >
                        <template x-if="!loading">
                            <span>Create Account & Start Free Trial</span>
                        </template>
                        <template x-if="loading">
                            <span class="flex items-center gap-2">
                                <i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i>
                                Creating account...
                            </span>
                        </template>
                    </button>
                </form>

                <div class="mt-6 text-center">
                    <p class="text-sm text-gray-400">
                        Already have an account? 
                        <a href="/auth/login" class="text-purple-400 hover:underline">Sign in</a>
                    </p>
                </div>

                <!-- Social Login -->
                <div class="mt-8">
                    <div class="flex items-center gap-4 mb-4">
                        <div class="flex-1 h-px bg-white/10"></div>
                        <span class="text-sm text-gray-500">Or continue with</span>
                        <div class="flex-1 h-px bg-white/10"></div>
                    </div>

                    <div class="grid grid-cols-2 gap-3">
                        <button 
                            @click="socialLogin('google')"
                            type="button"
                            class="flex items-center justify-center gap-2 px-4 py-3 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 transition-colors"
                        >
                            <svg class="w-5 h-5" viewBox="0 0 24 24">
                                <path fill="currentColor" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                                <path fill="currentColor" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                                <path fill="currentColor" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                                <path fill="currentColor" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                            </svg>
                            <span class="text-sm">Google</span>
                        </button>
                        
                        <button 
                            @click="socialLogin('twitter')"
                            type="button"
                            class="flex items-center justify-center gap-2 px-4 py-3 rounded-xl bg-white/5 border border-white/10 hover:bg-white/10 transition-colors"
                        >
                            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
                                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                            </svg>
                            <span class="text-sm">X / Twitter</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 3: Connect Platforms -->
        <div x-show="currentStep === 2" x-cloak>
            <div class="max-w-2xl mx-auto">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold mb-2">Connect Your Platforms</h1>
                    <p class="text-gray-400">Link the accounts you want AI agents to manage</p>
                </div>

                <div class="space-y-3">
                    <template x-for="platform in platforms" :key="platform.id">
                        <div 
                            class="p-4 rounded-xl bg-white/5 border border-white/10 flex items-center justify-between"
                            :class="{ 'border-green-500/50 bg-green-500/5': platform.connected }"
                        >
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-xl flex items-center justify-center"
                                    :class="platform.bgColor"
                                >
                                    <i :data-lucide="platform.icon" class="w-6 h-6" :class="platform.textColor"></i>
                                </div>
                                
                                <div>
                                    <div class="font-semibold" x-text="platform.name"></div>
                                    <div class="text-sm text-gray-400" 
                                          x-text="platform.connected ? (platform.channelName || 'Connected') : 'Not connected'"
                                    ></div>
                                </div>
                            </div>

                            <button 
                                @click="platform.connected ? disconnectPlatform(platform) : connectPlatform(platform)"
                                class="px-4 py-2 rounded-lg text-sm font-medium transition-colors flex items-center gap-2"
                                :class="platform.connected ? 'bg-green-500/10 text-green-400' : 'bg-white/10 hover:bg-white/20'"
                                :disabled="platform.loading"
                            >
                                <template x-if="platform.loading">
                                    <i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i>
                                </template>
                                
                                <span x-text="platform.connected ? 'Connected ‚úì' : 'Connect'"></span>
                            </button>
                        </div>
                    </template>
                </div>

                <!-- Skip option -->
                <div class="mt-6 text-center">
                    <button @click="finishSetup()" class="text-sm text-gray-400 hover:text-white">
                        Skip for now ‚Üí
                    </button>
                </div>

                <div class="mt-8 flex justify-between">
                    <button 
                        @click="currentStep = 1"
                        class="px-6 py-3 rounded-xl border border-white/10 hover:bg-white/5 transition-colors"
                    >
                        ‚Üê Back
                    </button>
                    
                    <button 
                        @click="finishSetup()"
                        class="gradient-purple px-8 py-3 rounded-xl font-semibold hover:opacity-90 transition-opacity"
                    >
                        Go to Dashboard ‚Üí
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function realAuth() {
            return {
                currentStep: 0,
                steps: ['Choose Plan', 'Create Account', 'Connect'],
                selectedPlan: null,
                loading: false,
                error: null,
                
                form: {
                    name: '',
                    email: '',
                    password: '',
                    agreed: false
                },
                
                errors: {},

                plans: [
                    {
                        id: 'starter',
                        name: 'Starter',
                        price: 500,
                        followers: '10K-100K followers',
                        popular: false,
                        features: ['Maya (Content)', 'Email support', '5 videos/month'],
                        agents: ['maya']
                    },
                    {
                        id: 'growth',
                        name: 'Growth',
                        price: 700,
                        followers: '100K-500K followers',
                        popular: true,
                        features: ['Maya + Engage', 'Priority support', 'Unlimited videos'],
                        agents: ['maya', 'engage']
                    },
                    {
                        id: 'pro',
                        name: 'Pro',
                        price: 1000,
                        followers: '500K-1M followers',
                        popular: false,
                        features: ['Maya + Engage + Pitch', '24/7 support', 'Brand deals'],
                        agents: ['maya', 'engage', 'pitch']
                    },
                    {
                        id: 'empire',
                        name: 'Empire',
                        price: 1200,
                        followers: '1M+ followers',
                        popular: false,
                        features: ['All 4 AI Agents', 'Dedicated manager', 'Custom integrations'],
                        agents: ['maya', 'engage', 'pitch', 'analyze']
                    }
                ],

                platforms: [
                    {
                        id: 'youtube',
                        name: 'YouTube',
                        icon: 'youtube',
                        bgColor: 'bg-red-500/10',
                        textColor: 'text-red-400',
                        connected: false,
                        loading: false,
                        channelName: null
                    },
                    {
                        id: 'tiktok',
                        name: 'TikTok',
                        icon: 'video',
                        bgColor: 'bg-pink-500/10',
                        textColor: 'text-pink-400',
                        connected: false,
                        loading: false,
                        channelName: null
                    },
                    {
                        id: 'instagram',
                        name: 'Instagram',
                        icon: 'instagram',
                        bgColor: 'bg-purple-500/10',
                        textColor: 'text-purple-400',
                        connected: false,
                        loading: false,
                        channelName: null
                    },
                    {
                        id: 'twitter',
                        name: 'X / Twitter',
                        icon: 'twitter',
                        bgColor: 'bg-blue-500/10',
                        textColor: 'text-blue-400',
                        connected: false,
                        loading: false,
                        channelName: null
                    }
                ],

                async createAccount() {
                    this.loading = true;
                    this.errors = {};
                    
                    try {
                        // Call your API
                        const response = await fetch(`${API_URL}/api/auth/register`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                email: this.form.email,
                                password: this.form.password,
                                name: this.form.name,
                                plan: this.selectedPlan
                            })
                        });
                        
                        const data = await response.json();
                        
                        if (!response.ok) {
                            throw new Error(data.error || 'Failed to create account');
                        }
                        
                        // Store session
                        if (data.session) {
                            localStorage.setItem('coexai_session', JSON.stringify(data.session));
                        }
                        
                        // Move to next step
                        this.currentStep = 2;
                        
                    } catch (err) {
                        this.error = err.message;
                        this.errors.email = err.message.includes('email') ? err.message : null;
                        this.errors.password = err.message.includes('password') ? err.message : null;
                    } finally {
                        this.loading = false;
                    }
                },

                async socialLogin(provider) {
                    try {
                        const { data, error } = await supabase.auth.signInWithOAuth({
                            provider: provider,
                            options: {
                                redirectTo: `${window.location.origin}/auth/callback`,
                                queryParams: {
                                    plan: this.selectedPlan
                                }
                            }
                        });
                        
                        if (error) throw error;
                        
                    } catch (err) {
                        this.error = err.message;
                    }
                },

                async connectPlatform(platform) {
                    platform.loading = true;
                    
                    try {
                        const token = JSON.parse(localStorage.getItem('coexai_session'))?.access_token;
                        
                        const response = await fetch(`${API_URL}/api/connect/${platform.id}`, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        
                        const data = await response.json();
                        
                        if (data.url) {
                            window.location.href = data.url;
                        }
                        
                    } catch (err) {
                        this.error = err.message;
                    } finally {
                        platform.loading = false;
                    }
                },

                async disconnectPlatform(platform) {
                    platform.loading = true;
                    
                    try {
                        const token = JSON.parse(localStorage.getItem('coexai_session'))?.access_token;
                        
                        await fetch(`${API_URL}/api/platforms/${platform.id}`, {
                            method: 'DELETE',
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        
                        platform.connected = false;
                        platform.channelName = null;
                        
                    } catch (err) {
                        this.error = err.message;
                    } finally {
                        platform.loading = false;
                    }
                },

                finishSetup() {
                    localStorage.setItem('coexai_onboarding_complete', 'true');
                    window.location.href = '/dashboard';
                },

                async loadConnectedPlatforms() {
                    try {
                        const token = JSON.parse(localStorage.getItem('coexai_session'))?.access_token;
                        
                        const response = await fetch(`${API_URL}/api/platforms`, {
                            headers: {
                                'Authorization': `Bearer ${token}`
                            }
                        });
                        
                        const data = await response.json();
                        
                        // Update platforms
                        data.connections?.forEach(conn => {
                            const platform = this.platforms.find(p => p.id === conn.platform);
                            if (platform) {
                                platform.connected = true;
                                platform.channelName = conn.channel_name;
                            }
                        });
                        
                    } catch (err) {
                        console.error('Failed to load platforms:', err);
                    }
                },

                init() {
                    // Check URL for plan parameter
                    const urlParams = new URLSearchParams(window.location.search);
                    const plan = urlParams.get('plan');
                    if (plan) {
                        this.selectedPlan = plan;
                    }
                    
                    // Check if returning from OAuth
                    const connected = urlParams.get('connected');
                    if (connected) {
                        this.currentStep = 2;
                        this.loadConnectedPlatforms();
                    }
                    
                    // Check if already logged in
                    const session = localStorage.getItem('coexai_session');
                    if (session) {
                        this.currentStep = 2;
                        this.loadConnectedPlatforms();
                    }
                }
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
        });
    </script>
</body>
</html>
